define(["faceitConsApp"+window.__env.minUrl,window.__env.baseUrl+"shared/sharedController"+window.__env.minUrl,window.__env.baseUrl+"services/sharedService"+window.__env.minUrl,window.__env.baseUrl+"directives/onlyDigits"+window.__env.minUrl],function(e){"use strict";e.controller("candidateController",["$scope","$rootScope","$routeParams","$location","sharedService","sharedMethod","storageFactory",function(s,a,e,t,r,c,i){s.Results=[],s.ResultsBackup=[],s.FilterItemsDisplay=[],s.FindString="",s.propertyName="",s.reverse=!1,s.pricestart=0,s.priceend=0,s.CanFilter={Company:!0,Assessed:!1,All:!1},s.OnLoadResults=function(){s.FilterItemsDisplay=c.ExcludeItem(s.FilterItemsDisplay,"FilterType","KeyWordSearch"),s.LoadDefaults()},s.LoadDefaults=function(){c.start(),s.FilterItemsDisplay=[],s.loadResults()},s.loadResults=function(){s.Results=[],s.ResultsBackup=[],s.FindString=i.getValue("FindString",""),r.GetAllCandidates(function(e){c.stop(),200===e.status&&(s.ResultsBackup=e.data.Results,s.Results=s.ResultsBackup,c.IsNull(s.FindString)||function(){var e=s.FindString.split(" "),t=c.ExcludeItem(s.FilterItemsDisplay,"Type","KeyWordSearch");angular.forEach(e,function(e){c.IsNull(e)||t.push({FilterIndex:0,FilterType:"KeyWordSearch",FilterLabel:e,FilterValue:e})});var a=1;angular.forEach(s.items,function(e){e.FilterIndex=a,a++}),s.FilterItemsDisplay=t}(),s.DoFilters())},function(e){c.stop()})},s.FilterClicked=function(e,t,a){s.FilterItemsDisplay=c.ExcludeItem(s.FilterItemsDisplay,"FilterType",e),s.FilterItemsDisplay.push({FilterIndex:0,FilterType:e,FilterLabel:t,FilterValue:a});var r=1;angular.forEach(s.FilterItemsDisplay,function(e){e.FilterIndex=r,r++}),s.DoFilters()},s.OnCandidateFilterC=function(){s.DoFilters()},s.OnCandidateFilterA=function(){s.DoFilters()},s.OnCandidateFilter=function(){s.CanFilter.Company=!1,s.CanFilter.Assessed=!1,s.DoFilters()},s.ClearFilter=function(){var e=c.GetItemsCount(s.FilterItemsDisplay,"FilterType","KeyWordSearch");s.ResetRadioCheckBoxes(""),s.FilterItemsDisplay=[],s.SrchSkillName="",s.SrchLocation="",s.SrchExp="0",s.SrchSalary="0",0<e?(c.clearValue("FindString"),s.LoadDefaults()):s.DoFilters()},s.RemoveFilter=function(e,t){if(s.ResetRadioCheckBoxes(t),"KeyWordSearch"===t){s.FilterItemsDisplay=c.ExcludeItem(s.FilterItemsDisplay,"FilterType","KeyWordSearch"),s.FindString="";for(var a=c.GetItems(s.FilterItemsDisplay,"FilterType","KeyWordSearch"),r=0;r<a.length;r++){var i=a[r].FilterValue;""===s.FindString?s.FindString=i:s.FindString+=" "+i}return c.setValue("FindString",s.FindString),void s.LoadDefaults()}var l=c.GetItem(s.FilterItemsDisplay,"FilterIndex",e);"SKeyWordSearch"===l.FilterType?c.GetItemsCount(s.FilterItemsDisplay,"FilterType","SKeyWordSearch")<=1&&(s.SrchSkillName=""):"SLocation"===l.FilterType?s.SrchLocation="":"SExperience"===l.FilterType?s.SrchExp="0":"SCTC"===l.FilterType&&(s.SrchSalary="0"),s.FilterItemsDisplay=c.ExcludeItem(s.FilterItemsDisplay,"FilterIndex",e),s.DoFilters()},s.sortBy=function(e,t,a){for(var r=["sort01","sort02","sort03","sort04"],i=0;i<r.length;i++)c.ChangeClass(r[i],"sortlabel"),r[i]===e&&c.ChangeClass(r[i],"sortlabel-selected");s.reverse=a&&s.propertyName===t?!s.reverse:a,s.propertyName=t},s.DoFilters=function(){s.Results=s.ResultsBackup;var e=s.FilterItemsDisplay;if(0<e.length)for(var t=0;t<e.length;t++)void 0!==e[t].FilterValue&&(s.Results=s.GetFilterInfo(s.Results,e[t].FilterType,e[t].FilterValue));s.CanFilter.Company&&!s.CanFilter.Assessed&&(s.Results=s.GetFilterInfo(s.Results,"List","Company")),!s.CanFilter.Company&&s.CanFilter.Assessed&&(s.Results=s.GetFilterInfo(s.Results,"List","Assessed")),s.CanFilter.Company||s.CanFilter.Assessed||(s.Results=[])},s.GetFilterInfo=function(e,t,a){var r=[];if("KeyWordSearch"===t)return e;if(0<e.length)for(var i=0;i<e.length;i++){var l,s;if("Rating"===t)a<=e[i][t]&&r.push(e[i]);else if("Gender"===t)e[i][t]===a&&r.push(e[i]);else if("CTC"===t||"SCTC"===t){"SCTC"===t&&(t="CTC");var n=1e5*parseFloat(e[i][t]);l=parseFloat(a.split("-")[0]),s=parseFloat(a.split("-")[1]),l<=n&&n<=s&&r.push(e[i])}else if("Experience"===t||"SExperience"===t){"SExperience"===t&&(t="Experience");var o=parseFloat(e[i].Years);l=parseFloat(a.split("-")[0]),s=parseFloat(a.split("-")[1]),l<=o&&o<=s&&r.push(e[i])}else if("ReviewsCount"===t)a<=e[i].HeaderContent[t]&&r.push(e[i]);else if("SLocation"===t)e[i].City.toLowerCase()===a.toLowerCase()&&r.push(e[i]);else if("SKeyWordSearch"===t){a=a.toLowerCase();var d=e[i].Name,u=e[i].KeySkills;d=c.IsNull(d)?"":d.toLowerCase(),u=c.IsNull(u)?"":u.toLowerCase(),-1<d.indexOf(a.toLowerCase())?r.push(e[i]):-1<u.indexOf(a.toLowerCase())&&r.push(e[i])}else"List"===t&&("Company"===a&&e[i].Internal?r.push(e[i]):"Assessed"!==a||e[i].Internal||r.push(e[i]))}return r},s.ViewProfile=function(e,t){t?a.NavigateToRoute("cnp/I"+e):a.NavigateToRoute("cnp/E"+e)},s.ResetRadioCheckBoxes=function(e){if(c.IsNull(e)||"Rating"===e){var t=c.GetItemsCount(s.FilterItemsDisplay,"FilterType","Rating");if(0<t)for(var a=1;a<=5;a++)c.RadioButtonStatus("radiorating"+a,!1)}if((c.IsNull(e)||"Experience"===e)&&0<(t=c.GetItemsCount(s.FilterItemsDisplay,"FilterType","Experience")))for(var r=1;r<=4;r++)c.RadioButtonStatus("radioexp"+r,!1);if((c.IsNull(e)||"CTC"===e)&&0<(t=c.GetItemsCount(s.FilterItemsDisplay,"FilterType","CTC"))){for(var i=1;i<=3;i++)c.RadioButtonStatus("radioprice"+i,!1);c.SetValue("pricestart","0"),c.SetValue("priceend","0")}if((c.IsNull(e)||"Gender"===e)&&0<(t=c.GetItemsCount(s.FilterItemsDisplay,"FilterType","Gender")))for(var l=1;l<=2;l++)c.RadioButtonStatus("radiogender"+l,!1)},s.CanName="",s.CanEmail="",s.CanPhone="",s.ShowHideCandidate=function(e){s.CanName="",s.CanEmail="",s.CanPhone="",c.SetValue("canName",""),c.SetValue("canEmail",""),c.SetValue("canPhone",""),e?c.Show("popAddNewCandidate"):c.Hide("popAddNewCandidate")},s.ToNullValue=function(e){return c.ToNullValue(e)},s.SubmitCandidate=function(){if(c.Hide("errCanAdd"),s.CanName=c.GetValue("canName"),s.CanEmail=c.GetValue("canEmail"),s.CanPhone=c.GetValue("canPhone"),c.IsNull(s.CanName)||c.IsNull(s.CanEmail)||c.IsNull(s.CanPhone))return c.SetText("errCanAdd","All fields are mandatory"),void c.Show("errCanAdd");if(!c.IsValidEmail(s.CanEmail))return c.SetText("errCanAdd","Enter valid e-mail"),void c.Show("errCanAdd");c.start();var e={Name:s.CanName,Email:s.CanEmail,Phone:s.CanPhone};r.AddCandidate(e,function(e){c.stop(),200===e.status&&(0===parseInt(e.data.Results)?(c.SetText("errCanAdd","E-mail already registered."),c.Show("errCanAdd")):-1===parseInt(e.data.Results)?(c.SetText("errCanAdd","System fail to process. Please try again."),c.Show("errCanAdd")):(s.loadResults(),s.ShowHideCandidate(!1),c.Show("popAddCandidateSuccessful")))},function(e){c.stop()})},s.ChangePhoto=function(e,t){a.$broadcast("OpenPhotoForEdit",{Candidate:!0,KeyId:e,Photo:t})},a.$on("CanPhotoUpdated",function(e,t){var a=t.KeyId,r=t.Photo;angular.forEach(s.Results,function(e){e.CandidateId===a&&(e.Photo=r)})}),s.SrchSkillName="",s.SrchLocation="",s.SrchExp="0",s.SrchSalary="0",s.OnSearchFilterClicked=function(){var e=s.SrchSkillName.split(" "),t=[];s.FilterItemsDisplay=[];var a=1;if(angular.forEach(e,function(e){c.IsNull(e)||(t.push({FilterIndex:a,FilterType:"SKeyWordSearch",FilterLabel:e,FilterValue:e}),a++)}),s.FilterItemsDisplay=t,c.IsNull(s.SrchLocation)||(a++,s.FilterItemsDisplay.push({FilterIndex:a,FilterType:"SLocation",FilterLabel:s.SrchLocation,FilterValue:s.SrchLocation})),c.IsNull(s.SrchExp)||"0"===s.SrchExp||(a++,s.FilterItemsDisplay.push({FilterIndex:a,FilterType:"SExperience",FilterLabel:s.SrchExp,FilterValue:s.SrchExp})),!c.IsNull(s.SrchSalary)&&"0"!==s.SrchSalary){a++;var r="";switch(s.SrchSalary){case"100000-500000":r="01 Lakh - 5 Lakh";break;case"500000-1000000":r="06 Lakh - 10 Lakh";break;case"1000000-9999999":r="Over 10 Lakh"}s.FilterItemsDisplay.push({FilterIndex:a,FilterType:"SCTC",FilterLabel:r,FilterValue:s.SrchSalary})}s.DoFilters()}}])});