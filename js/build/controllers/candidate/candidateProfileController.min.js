define(["faceitConsApp"+window.__env.minUrl,window.__env.baseUrl+"shared/sharedController"+window.__env.minUrl,window.__env.baseUrl+"services/sharedService"+window.__env.minUrl,window.__env.baseUrl+"directives/range"+window.__env.minUrl,window.__env.baseUrl+"directives/googlePlace"+window.__env.minUrl,window.__env.baseUrl+"directives/fileChange"+window.__env.minUrl],function(e){"use strict";e.controller("candidateProfileController",["$scope","$rootScope","$routeParams","sharedMethod","sharedService",function(r,s,e,i,l){r.DisableSharing=!0,r.frmProDetails={},r.Result={},r.PlayerObject={},r.CTC={Current:{L:0,T:0},Expected:{L:0,T:0}},r.Notes=[],r.ItSkills=[{SkillId:0,SkillName:"",UserId:0,Years:0,Months:0,RecordStatus:0,ItemIndex:0}],r.expYear=0,r.expMonth=0;var u=e.Id,t=!0;function n(e){if(200===e.status){r.Result=e.data.Results,h(r.Result.CTC,"C"),h(r.Result.ECTC,"E"),h(r.Result.Years,"EX"),r.ItSkills=r.Result.ITSkills;var t=0;angular.forEach(r.ItSkills,function(e){t++,e.ItemIndex=t}),i.IsArrayEmpty(r.ItSkills)&&(r.ItSkills=[]),i.stop()}}function a(e){i.stop()}u.startsWith("E")?(t=!1,u=u.substring(1)):u.startsWith("I")&&(t=!0,u=u.substring(1)),r.SharedList=[],r.OnLoadResults=function(){i.start(),l.GetNotes(u,function(e){200===e.status&&(r.Notes=e.data.Results)},function(e){}),t?l.GetCandidate(u,n,a):l.GetHGCandidate(u,n,a)},r.OnPlayAtPosition=function(e,t){var s=$("#video_"+e);null!==s&&(s[0].currentTime=t)},r.SharingSelected=function(t){angular.forEach(r.Result.CompletedSessions,function(e){e.SessionId===t&&(e.StatusCheck=!e.StatusCheck)});var e=i.GetItemsCount(r.Result.CompletedSessions,"StatusCheck",!0);r.DisableSharing=!(0<e)};var o=!(r.OnCShareSessionClicked=function(){d("",0),i.Show("popShareSessionDiv")});function d(e,t){i.SetText("errorCShare",""),i.SetText("successCShare",""),i.Hide("errorCShare"),i.Hide("successCShare"),i.IsNull(e)||(0===t?(i.SetText("successCShare",e),i.Show("successCShare")):(i.SetText("errorCShare",e),i.Show("errorCShare")))}r.CShareGDPR=!1,r.OnCSubmitSharedClicked=function(){o=!1,d("",0);var t=i.GetValue("txtCShareEmail");if(!i.IsNull(t)&&i.IsValidEmail(t)){var s="";if(r.CShareGDPR&&(s=i.GetValue("txtCSharedName"),i.IsNull(s)))d("Provide company or contact name",-1);else{i.start();var n=[];angular.forEach(r.Result.CompletedSessions,function(e){e.StatusCheck&&n.push({SharedId:e.SessionId,Email:t,SharedName:s})}),l.SharedSession(n,function(e){200===parseInt(e.status)&&200===parseInt(e.data.status)?(d("Session shared successfully",0),i.Hide("btnCShareSession"),i.stop()):(d(e.data.statusText,-1),i.stop())},function(e){i.stop()}),o=!0}}else d("Enter valid e-mail address",-1)},r.OnCCancelSharedClicked=function(){d("",0),r.CShareGDPR=!1,i.SetValue("txtCShareEmail",""),i.SetValue("txtCSharedName",""),i.ShowInline("btnCShareSession"),i.Hide("popShareSessionDiv"),r.DisableSharing=!0,angular.forEach(r.Result.CompletedSessions,function(e){var t="chk_"+e.SessionId+"_"+e.SessionTag;i.RadioButtonStatus(t,!1),e.StatusCheck=!1}),o&&r.OnLoadResults()},r.OnCSubmitSharedUpdated=function(){var e=i.GetItems(r.Result.SharedByList,"Approved",!0);i.IsArrayEmpty(e)||(i.start(),l.SetCSharedList(e,function(e){i.stop()},function(e){i.stop()}))},r.ToNullValue=function(e){return i.ToNullValue(e)},r.IsVideoLinkExist=function(e){return!i.IsNull(e)},r.IsSharingCount=function(){return 0===i.GetItemsCount(r.Result.CompletedSessions,"Shared","true")},r.GetIteSkillCount=function(){return i.GetItemsCount(r.ItSkills,"RecordStatus",0)},r.AddNewSkill=function(){r.ItSkills.push({SkillId:0,SkillName:"",UserId:u,Years:0,Months:0,RecordStatus:0,ItemIndex:r.ItSkills.length+1})},r.DeleteSkill=function(t){angular.forEach(r.ItSkills,function(e){e.ItemIndex===t&&(e.RecordStatus=2)})},r.SubmitPersonalDetails=function(){i.Hide("errsubmit"),i.Hide("errFilesubmit"),i.Hide("sucsubmit"),i.Hide("errsubmit2"),r.frmProDetails.$valid?i.IsNull(r.Resume)?C():function(){i.start();var e=new FormData;e.append("TypeOfDoc","Resumes"),e.append("UserId",u),e.append("FileData",r.Resume),e.append("AddToProfile",!0),l.UploadContents(e,c,S)}():i.Show("errsubmit")};var c=function(e){i.stop(),C()},S=function(e){i.stop(),i.show("errFilesubmit")};function C(){var e=i.GetValue("txtcity");i.IsNull(e)&&(e=r.Result.Address.City);var t=i.GetValue("txtstate");i.IsNull(t)&&(t=r.Result.Address.State);var s=i.GetValue("txtcountry");i.IsNull(s)&&(s=r.Result.Address.Country);var n=i.GetText("txtDailingCode");i.IsNull(n)&&(n=r.Result.Address.DailingCode);var a,o={CandidateId:u,Name:i.GetValue("txtName"),Email:i.GetValue("txtEmail"),Gender:r.Result.Gender,Years:r.expYear+"."+r.expMonth,CTC:r.CTC.Current.L+"."+r.CTC.Current.T,ECTC:r.CTC.Expected.L+"."+r.CTC.Expected.T,LinkedIn:i.GetValue("txtLinedIn"),ITSkills:(a=[],angular.forEach(r.ItSkills,function(e){(0===e.RecordStatus||2===e.RecordStatus&&0<e.SkillId)&&a.push(e)}),a),Address:{City:e,State:t,Country:s,DailingCode:n,MobileNumber:i.GetValue("txtPhoneNumber")}};i.start(),l.UpdateCandidate(o,function(e){200===e.status&&(i.Show("sucsubmit"),i.stop(),r.OnLoadResults())},function(e){i.Show("errsubmit2"),i.stop()})}function h(e,t){var s=0,n=0;if(e){var a=e.toString().split(".");s=parseInt(a[0]),n=parseInt(a[1]),isNaN(s)&&(s=0),isNaN(n)&&(n=0)}"C"===t?(r.CTC.Current.L=s,r.CTC.Current.T=n):"E"===t?(r.CTC.Expected.L=s,r.CTC.Expected.T=n):"EX"===t&&(r.expYear=s,r.expMonth=n)}r.NoteText="",r.AddNote=function(){if(r.NoteText=i.GetValue("noteText"),i.Hide("noteErrorMsg"),i.IsNull(r.NoteText))i.Show("noteErrorMsg");else{i.start();var e={NoteText:r.NoteText,UserId:u};l.AddNotes(e,function(e){200===e.status&&(l.GetNotes(u,function(e){200===e.status&&(r.Notes=e.data.Results)},function(e){}),i.stop()),r.HideNote()},function(e){console.log(e),i.stop()})}},r.HideNote=function(){i.Hide("noteErrorMsg"),r.NoteText="",i.Hide("popProfileNote")},r.ChangePhoto=function(e,t){s.$broadcast("OpenPhotoForEdit",{Candidate:!0,KeyId:e,Photo:t})},s.$on("CanPhotoUpdated",function(e,t){t.KeyId;var s=t.Photo;r.Result.Photo=s})}])});