define(["faceitconfig"+window.__env.minUrl,"angular-sanitize",,window.__env.baseUrl+"controllers/shared/SharedController"+window.__env.minUrl,window.__env.baseUrl+"services/sharedMethod"+window.__env.minUrl,window.__env.baseUrl+"services/sharedService"+window.__env.minUrl],function(e){"use strict";e.controller("MessageController",["$scope","$rootScope","$location","sharedService","sharedMethod","storageFactory",function(n,s,e,a,r,t){n.Messages=[],n.MessagesBackup=[],n.MessageHeader="",n.SelectedAll=!1,n.EnableDeleted=!0,n.FilterType="",n.FilterTypeId="-1",n.$on("LoadDefaults",function(e,s){t.clearValue("FindString"),n.LoadDefaults()}),n.LoadDefaults=function(){r.start(),a.GetAllFIMessages(n.MessagesRetrievedSuccess,n.MessagesRetrievedFailed)},n.MessagesRetrievedSuccess=function(e){if(n.MessageHeader="",n.Messages=e,200==parseInt(e.status)){n.Messages=e.data.Results,angular.forEach(n.Messages,function(e){e.Checked=!1,e.MsgFrom=e.MsgFrom.split("<")[0]});var s=r.GetItemsCount(n.Messages,"MsgRead",!1),a=n.Messages.length;n.MessageHeader=a+" / "+s+" Unread"}n.MessagesBackup=n.Messages,r.Hide("nomsgcontent"),0==n.Messages.length&&r.Show("nomsgcontent"),r.stop()},n.MessagesRetrievedFailed=function(e){r.stop()};var l=0;n.PreviewPanelVisible=function(e){var s="Block"+e;return r.IsElmVisible(s)},n.ShowOneBlock=function(a){var t=!1;angular.forEach(n.Messages,function(e){var s="Block"+e.MsgId;r.Hide(s),e.MsgId===a&&l!==a&&(t=!0,r.Show(s),l=a,e.MsgRead||(e.MsgRead=!0,n.UpdateMessage(e)))}),t||(l=0)},n.UpdateMessage=function(e){r.start(),a.UpdateFIMessage(e,n.UpdateMessageSuccess,n.MessagesRetrievedFailed)},n.UpdateMessageSuccess=function(e){r.stop(),s.$broadcast("MessageUpdated",null)},n.AllSelectedChecked=function(){angular.forEach(n.Messages,function(e){e.Checked=n.SelectedAll}),n.UnSelectChecked()},n.DeleteClicked=function(){angular.forEach(n.Messages,function(e){e.Checked&&(e.RecordStatus=2)});var e=r.GetItems(n.MessagesBackup,"Checked",!0);r.start(),a.DeleteFIMessages(e,n.LoadDefaults,n.MessagesRetrievedFailed)},n.UnSelectChecked=function(){var e=r.GetItemsCount(n.Messages,"Checked",!1);n.SelectedAll=0===e,e=r.GetItemsCount(n.Messages,"Checked",!0),n.EnableDeleted=0==e},n.FilterChanged=function(){n.FilterType="",n.SelectedAll=!1,-1===parseInt(n.FilterTypeId)?n.Messages=n.MessagesBackup:0===parseInt(n.FilterTypeId)?n.Messages=r.GetItems(n.MessagesBackup,"MsgRead",!1):1===parseInt(n.FilterTypeId)&&(n.Messages=r.GetItems(n.MessagesBackup,"MsgRead",!0))}}])});