define(["faceitConsApp"+window.__env.minUrl,window.__env.baseUrl+"services/sharedMethod"+window.__env.minUrl,window.__env.baseUrl+"directives/onlyDigits"+window.__env.minUrl,window.__env.baseUrl+"directives/fileChange"+window.__env.minUrl,window.__env.baseUrl+"services/sharedService"+window.__env.minUrl],function(e){"use strict";e.controller("popupController",["$scope","$rootScope","sharedService","sharedMethod",function(s,a,t,o){function n(e){o.Hide("cancelErrorMsg"),o.IsNull(e)||(o.SetText("cancelErrorMsg",e),o.Show("cancelErrorMsg"))}function i(){s.ns={CandidateName:"",CandidateEmail:"",CandidatePhone:"",InterviewerEmail:"",InterviewerName:"",InterviewerPhone:"",InterviewerRate:"",InterviewTopic:"",InterviewDate:"",CorporateName:"",CorporateMobile:"",CorporateEmail:"",CompanyId:0,ContactId:0,JDProfile:"",SharedJDProfile:"",Resume:"",SharedResume:""},s.Date="",s.Hours="0",s.Minutes="-1",s.AMPM="AMPM",o.SetText("schErrDisplay",""),o.Hide("schErrDisplay"),o.Show("dummyDisplay"),o.SetDisabled("btnSubmitNewSch",!1),$("#sessionResume").val(""),$("#sessionJobDesc").val("")}function r(e){o.SetText("schErrDisplay",e),o.Show("schErrDisplay"),o.Hide("dummyDisplay")}s.SelectedSession={},s.$on("ShowContact",function(e,n){s.SelectedSession=n.Selected,o.Show("popContactDetails")}),s.$on("HideContact",function(e,n){s.SelectedSession={},o.Hide("popContactDetails")}),s.reasonToCancel="",s.CancelledId=0,s.$on("ShowCancelSession",function(e,n){s.CancelledId=n.KeyId,o.Show("popCancelInterviewNote")}),s.SubmitCancelSession=function(){if(n(""),s.reasonToCancel=o.GetValue("reasonToCancel"),o.IsNull(s.reasonToCancel))n("Please add a reason for cancelling");else{var e={Reason:s.reasonToCancel,SessionId:s.CancelledId};o.start(),t.CancelSessions(e,function(e){(o.stop(),200==parseInt(e.status))?"Success"===e.data.Results?(s.HideCancelSession(),a.$broadcast("RefreshDSession",{}),a.$broadcast("RefreshSSession",{})):n("System fail to process. Please try again."):n("System fail to process. Please try again.")},function(e){o.stop(),n("System fail to process. Please try again.")})}},s.HideCancelSession=function(){s.CancelledId=0,s.reasonToCancel="",s.SelectedSession={},o.Hide("cancelErrorMsg"),o.Hide("popCancelInterviewNote"),o.SetValue("reasonToCancel","")},s.$on("ShowCancelledSession",function(e,n){o.start(),t.GetCancelSessionReason(n.KeyId,function(e){o.stop(),200==parseInt(e.status)&&(s.reasonToCancel=e.data.Results.Reason),o.Show("popCancelReason")},function(e){o.stop()})}),s.ns={},s.Date="",s.Hours="0",s.Minutes="-1",s.AMPM="AMPM",s.$on("NewSession",function(e,n){i(),loadCalendar(),o.Show("popNewSchedule")}),s.HideNewScheduledSession=function(){i(),o.Hide("popNewSchedule"),a.$broadcast("RefreshDSession",{}),a.$broadcast("RefreshSSession",{})},s.frmNewSession={},s.SubmitNewScheduledSession=function(){o.Show("dummyDisplay"),o.Hide("schErrDisplay"),o.IsNull(s.ns.CandidateEmail)?r("Candidate email is required"):o.IsNull(s.ns.CandidateName)?r("Candidate name is required"):o.IsNull(s.ns.InterviewerEmail)?r("Interviewer email is required"):o.IsNull(s.ns.InterviewerName)?r("Interviewer name is required"):o.IsNull(s.ns.InterviewTopic)?r("Interview topic is required"):o.IsNull(s.Date)?r("Interview date is required"):parseInt(s.Hours)<1||parseInt(s.Minutes)<0||"AMPM"===s.AMPM?r("Interview time is required"):s.ns.CandidateEmail!==s.ns.InterviewerEmail?o.IsNull(s.ns.CandidatePhone)||o.IsNull(s.ns.InterviewerPhone)||s.ns.CandidatePhone!==s.ns.InterviewerPhone?s.frmNewSession.$valid&&(r("Please wait..."),s.ns.InterviewDate=s.Date+" "+s.Hours+":"+s.Minutes+" "+s.AMPM,s.ns.CompanyId=s.CompanyId,s.ns.ContactId=s.ContactId,o.start(),s.CheckForUploadResume()):r("Mobile numbers should not be same"):r("Emails should not be same")},s.CheckForUploadResume=function(){if(o.IsNull(s.ns.Resume))s.CheckForUploadJDProfile();else{var e=new FormData;e.append("TypeOfDoc","Resumes"),e.append("UserId",0),e.append("FileData",s.ns.Resume),e.append("AddToProfile",!1),t.UploadContents(e,function(e){200===e.status&&200===e.data.status?(s.ns.SharedResume=e.data.Results,s.CheckForUploadJDProfile()):(r("System fail to process. Please try again."),o.stop())},function(e){r("System fail to process. Please try again."),o.stop()})}},s.CheckForUploadJDProfile=function(){if(o.IsNull(s.ns.JDProfile))s.UpdateNewSession();else{var e=new FormData;e.append("TypeOfDoc","Resumes"),e.append("UserId",0),e.append("FileData",s.ns.JDProfile),e.append("AddToProfile",!1),t.UploadContents(e,function(e){200===e.status&&200===e.data.status?(s.ns.SharedJDProfile=e.data.Results,s.UpdateNewSession()):(r("System fail to process. Please try again."),o.stop())},function(e){r("System fail to process. Please try again."),o.stop()})}},s.UpdateNewSession=function(){t.AddSession(s.ns,function(e){200===e.status?0===parseInt(e.data.Results)?r("System fail to process. Please try again."):(r("Session created successful."),o.SetDisabled("btnSubmitNewSch",!0)):r("System fail to process. Please try again."),o.stop()},function(e){r("System fail to process. Please try again."),o.stop()})},s.OnCanEmailChanged=function(){var e={Id:0,Text:s.ns.CandidateEmail};t.GetNameByEmail(e,function(e){200===e.status&&(s.ns.CandidateName=e.data.Results.Item1,s.ns.CandidatePhone=e.data.Results.Item2)},function(e){console.log(e)})},s.OnEvaEmailChanged=function(){var e={Id:1,Text:s.ns.InterviewerEmail};t.GetNameByEmail(e,function(e){200===e.status&&(s.ns.InterviewerName=e.data.Results.Item1,s.ns.InterviewerPhone=e.data.Results.Item2)},function(e){console.log(e)})},s.OnCorpEmailChanged=function(){var e={Id:3,Text:s.ns.CorporateEmail};t.GetNameByEmail(e,function(e){200===e.status&&(s.ns.CorporateName=e.data.Results)},function(e){console.log(e)})},a.$on("PhotoToDelete",function(e,n){o.Show("popDeletePhoto")}),s.DoDeletePhoto=function(){t.DeletePhoto({Id:0},e,l)};var e=function(e){var n=e.data.Results;$user.Set("Photo",n),s.ResetValues(),o.broadCastPhoto(a),o.Hide("popDeletePhoto")},l=function(e){alert("Error some thing goes wrong")}}])});