define(["faceitConsApp"+window.__env.minUrl,window.__env.baseUrl+"shared/sharedController"+window.__env.minUrl,window.__env.baseUrl+"services/sharedMethod"+window.__env.minUrl,window.__env.baseUrl+"controllers/popups/popupController"+window.__env.minUrl,window.__env.baseUrl+"services/sharedService"+window.__env.minUrl],function(e){"use strict";e.controller("sessionController",["$scope","$rootScope","$routeParams","$location","sharedService","sharedMethod","$sce","user",function(S,s,e,t,o,d,i,n){S.ScheduledBackupItems=[],S.SessionFilters=[],S.filterStatus="Status",S.SessionIdFilters=[],S.filterIdStatus="Session Id",S.companySearch="",S.SelectedSession={},S.reasonToCancel="",S.FilterItemsDisplay=[];var l=d.IsNull(e.Id)?0:e.Id;S.Initialize=function(){S.FilterItemsDisplay=[],S.companySearch="",setTimeout(function(){d.start(),S.ScheduledItems=[],o.GetAllsessions(function(e){200===e.status&&(S.ScheduledBackupItems=e.data.Results,S.SessionIdFilters=d.GetSingleColumnValuesDefault(S.ScheduledBackupItems,"SessionTag","Session Id"),u()),d.stop(),setTimeout(function(){0<l&&S.ShowOneBlock(parseInt(l))},100)},function(e){console.log(e),d.stop()})},100)},S.ShowOneBlock=function(e,t){S.SelectedSession={};var s,i=void 0;if(i=t?a(e):r(e)){var n="Block_"+i.SessionId+"_"+i.SessionTag,l="Refresh_"+i.SessionId+"_"+i.SessionTag;"Completed"===i.StatusTag&&(s=i.SessionId,d.start(),o.GetCompletedSession(s,function(e){200===e.status&&(S.SelectedSession=e.data.Results),d.stop()},function(e){console.log(e),d.stop()})),d.Show(n),d.ShowInline(l)}};var a=function(t){var s=void 0;return angular.forEach(S.SessionFilters,function(e){t===e.SessionId&&(s=e)}),s},r=function(e){for(var t=void 0,s=0;s<S.SessionFilters.length;s++){var i=S.SessionFilters[s],n=i.SessionId,l="Block_"+i.SessionId+"_"+i.SessionTag,o="Refresh_"+i.SessionId+"_"+i.SessionTag;d.Hide(o);var a=d.getElement("labelText_"+i.SessionId);a&&a.val("View");var r=d.getElement(l);r&&(e===n&&"block"!==r[0].style.display&&(t=i,a.val("Hide")),"block"===r[0].style.display&&d.Hide(l))}return t};function u(){S.SessionFilters=S.ScheduledBackupItems;var e=S.FilterItemsDisplay;if(0<e.length)for(var t=0;t<e.length;t++)null!=e[t].FilterValue&&(1===e[t].FilterIndex?S.SessionFilters=d.GetItems(S.SessionFilters,"SessionTag",e[t].FilterValue):2===e[t].FilterIndex?S.SessionFilters=d.GetItems(S.SessionFilters,"StatusTag",e[t].FilterValue):3===e[t].FilterIndex&&(S.SessionFilters=d.GetContainedItems(S.SessionFilters,"CandidateName",e[t].FilterValue)))}S.OnPlayAtPosition=function(e){var t=$("#sessionvideocontrol");null!==t&&(t[0].currentTime=e)},S.OnFilterIdChanged=function(){S.FilterItemsDisplay=d.ExcludeItem(S.FilterItemsDisplay,"FilterIndex",1),"Session Id"!=S.filterIdStatus&&S.FilterItemsDisplay.push({FilterIndex:1,FilterType:"Session",FilterLabel:"Session Id",FilterValue:S.filterIdStatus}),u()},S.OnFilterStatusChanged=function(){S.FilterItemsDisplay=d.ExcludeItem(S.FilterItemsDisplay,"FilterIndex",2),"Status"!=S.filterStatus&&S.FilterItemsDisplay.push({FilterIndex:2,FilterType:"Status",FilterLabel:"Status",FilterValue:S.filterStatus}),u()},S.OnFilterSearch=function(){S.FilterItemsDisplay=d.ExcludeItem(S.FilterItemsDisplay,"FilterIndex",3),d.IsNull(S.companySearch)||S.FilterItemsDisplay.push({FilterIndex:3,FilterType:"Search",FilterLabel:"Candidate Name",FilterValue:S.companySearch}),u()},S.RemoveFilter=function(e){S.FilterItemsDisplay=d.ExcludeItem(S.FilterItemsDisplay,"FilterIndex",e),1===e?S.filterIdStatus="Session Id":2===e?S.filterStatus="Status":3===e&&(S.companySearch=""),u()},S.ClearFilters=function(){S.FilterItemsDisplay=[],S.filterStatus="Status",S.filterIdStatus="Session Id",u()},S.$on("RefreshSSession",function(e,t){S.Initialize()}),S.ShowContact=function(e){var t=d.GetItem(S.SessionFilters,"SessionId",e);s.$broadcast("ShowContact",{Selected:t})},S.HideContact=function(){s.$broadcast("HideContact",null)},S.ShowCancelSession=function(e){s.$broadcast("ShowCancelSession",{KeyId:e})},S.ShowNewScheduledSession=function(){s.$broadcast("NewSession",null)},S.IsValueFound=function(e){return!d.IsNull(e)};var c=0;function I(e,t){d.SetText("errorShare",""),d.SetText("successShare",""),d.Hide("errorShare"),d.Hide("successShare"),d.IsNull(e)||(0===t?(d.SetText("successShare",e),d.Show("successShare")):(d.SetText("errorShare",e),d.Show("errorShare")))}S.OnShareSessionClicked=function(e){I("",0),c=e,d.Show("popShareSessionDiv")},S.ShareGDPR=!1,S.OnSubmitSharedClicked=function(){I("",0);var e=d.GetValue("txtShareEmail");if(!d.IsNull(e)&&d.IsValidEmail(e)){var t="";if(S.ShareGDPR&&(t=d.GetValue("txtSharedName"),d.IsNull(t)))I("Provide company or contact name",-1);else{d.start();var s=[{SharedId:c,Email:e,SharedName:t}];o.SharedSession(s,function(e){200===parseInt(e.status)&&200===parseInt(e.data.status)?(I("Session shared successfully",0),d.Hide("btnShareSession"),S.ShowOneBlock(c,!0),d.stop()):(I(e.data.statusText,-1),d.stop())},function(e){d.stop()})}}else I("Enter valid e-mail address",-1)},S.OnCancelSharedClicked=function(){I("",c=0),S.ShareGDPR=!1,d.SetValue("txtShareEmail",""),d.SetValue("txtSharedName",""),d.Hide("popShareSessionDiv"),d.ShowInline("btnShareSession")},S.ShowRecoredLink=function(e){d.AddVideoSrc("sessionvideocontrol",e),d.TriggerDialog("popRecordedVideoDiv",!0)},S.OnSharedUpdateClicked=function(e){d.start(),o.SetSharedList(e,function(e){d.stop()},function(e){d.stop()})}}])});