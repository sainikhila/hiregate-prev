define(["faceitConsApp"+window.__env.minUrl,window.__env.baseUrl+"services/sharedService"+window.__env.minUrl,window.__env.baseUrl+"services/sharedMethod"+window.__env.minUrl,window.__env.baseUrl+"directives/filePhotoChange"+window.__env.minUrl,window.__env.baseUrl+"factory/ng-img-crop"+window.__env.minUrl],function(s){"use strict";s.controller("menuController",["$scope","$rootScope","sharedService","sharedMethod","user","$sce","storageFactory",function(a,e,n,r,t,s,o){function i(){a.AccountPhoto=t.Get("Photo")+"?v="+r.GetRandomNumber(11111,99999);a.AddPhoto=!1,a.AccountPhoto.indexOf("photo_n.jpeg")&&(a.AddPhoto=!0)}function l(){a.SigninEmail="",a.SigninPws="",a.ForgotPwsEmail="",a.error_message1="",a.error_message2="",r.Hide("displayerror1"),r.Hide("displayerror2")}function d(s){a.error_message1="",r.Hide("displayerror1"),r.IsNull(s)||(a.error_message1=s,r.Show("displayerror1"))}a.AccountPhoto="",i(),a.LoadForPhotoEdit=function(){e.$broadcast("OpenPhotoForEdit",{Contact:!0,Photo:t.Get("Photo")})},a.DeleteAccountPhoto=function(){e.$broadcast("PhotoToDelete",{Contact:!0})},e.$on("PhotoChanged",function(s,e){i()}),a.SigninEmail="",a.SigninPws="",a.ForgotPwsEmail="",a.error_message1="",a.error_message2="",a.ChangePwsOPws="",a.ChangePwsNPws="",a.ChangePwsCPws="",a.ShowSignInPopup=function(){a.ShowLoginPanel(),r.TriggerDialog("signin_show2",!1)},a.ShowLoginPanel=function(){l(),r.Hide("fgt-pswd"),r.Show("logindetails")},a.ShowForgotPwsPanel=function(){l(),r.Hide("logindetails"),r.Show("fgt-pswd")},e.$on("BadRequest",function(s,e){200!==e.status&&(r.stop(),d(e.msg))}),a.SignInClicked=function(){d("");var s=a.SigninPws,e=a.SigninEmail;if(r.IsNull(s)||r.IsNull(e))d("Invalid Credentials. Please retry");else if(r.IsValidEmail(e)){r.start();var t={Email:e,Password:s};n.LoginToServer(r.EncodeDetails(t),w,g)}else d("Invalid e-mail address")};var w=function(s){200===parseInt(s.status)?(o.setValue("Identity",s.data),200!==parseInt(s.data.status)?(s.data.statusText.startsWith("Invalid token")?d("System fail to process. Please try again."):d(s.data.statusText),r.stop()):n.GetLoggedInUser(function(s){r.stop(),200===parseInt(s.status)&&200===parseInt(s.data.status)?(t.setModal(s.data.Results),e.NavigateToRoute("db")):s.data.statusText.startsWith("Invalid token")?d("System fail to process. Please try again."):d(s.data.statusText)},function(s){d("System fail to process. Please try again."),r.stop()})):(d("System fail to process. Please try again."),r.stop())},g=function(s){d("System fail to process. Please try again."),r.stop()};function c(s,e){a.error_message2="",r.Hide("displayerror2"),r.IsNull(s)||(a.error_message2=s,r.Show("displayerror2"))}a.ForgotPwsClicked=function(){c("");var s=a.ForgotPwsEmail;!r.IsNull(s)&&r.IsValidEmail(s)?(r.start(),n.ForgotPassword(s,function(s){(r.stop(),0===parseInt(s.data.Results)||"Success"===s.data.Results)?c("Password sent your registered e-mail."):c(r.ResultCodeStatus(parseInt(s.data.Results)))},function(s){c("System fail to process.Please try again."),r.stop()})):c("Invalid Email ID. Please retry")},a.SignOutClicked=function(){n.LogoutFromServer(u,u)};var u=function(s){sessionStorage.clear(),t.Init(),e.NavigateToRoute("/")};function P(s,e){a.ChangePwsError="",r.Hide("errChangePws"),r.IsNull(s)?e&&(r.Hide("changepassword"),r.Show("success")):(a.ChangePwsError=s,r.Show("errChangePws"))}a.ShwoChangedPassword=function(){a.ChangePwsCPws="",a.ChangePwsOPws="",a.ChangePwsNPws="",a.ChangePwsError="",r.Show("changepassword"),r.Hide("success"),r.Hide("errChangePws"),r.TriggerDialog("pswd_show2",!1)},a.ChangePwsClicked=function(){P("",!1);var s=a.ChangePwsNPws,e=a.ChangePwsOPws,t=a.ChangePwsCPws;if(r.IsNull(s)||r.IsNull(e)||r.IsNull(t))P("All fields are mandatory.",!1);else if(s===t){r.start();var o={Password:s,OldPassword:e};n.ChangePassword(o,function(s){(r.stop(),0===parseInt(s.data.Results)||"Success"===s.data.Results)?(a.ChangePwsOPws="",a.ChangePwsNPws="",P(a.ChangePwsCPws="",!0)):P(r.ResultCodeStatus(parseInt(s.data.Results)),!1)},function(s){P("System fail to process.Please try again.",!1),r.stop()})}else P("Password does not match.",!1)}}])});