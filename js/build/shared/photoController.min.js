define(["faceitConsApp"+window.__env.minUrl,window.__env.baseUrl+"services/sharedService"+window.__env.minUrl,window.__env.baseUrl+"services/sharedMethod"+window.__env.minUrl,window.__env.baseUrl+"directives/filePhotoChange"+window.__env.minUrl,window.__env.baseUrl+"factory/ng-img-crop"+window.__env.minUrl],function(o){"use strict";o.controller("photoController",["$scope","$rootScope","sharedService","sharedMethod","user","$sce",function(a,t,o,n,r,i){a.WebCam=!0;var d=r.Get("Photo"),s=0,l=!1,c=!1,m=!1,p="";d.endsWith("photo_n.jpeg")&&(a.AddPhoto=!0),t.$on("OpenPhotoForEdit",function(e,o){n.Hide("btnUploadPhoto"),a.WebCam=!1,l=o.Candidate||!1,c=o.Company||!1,m=o.Contact||!1,s=o.KeyId||0,p=o.Photo||"",m&&(p=r.Get("Photo")),n.IsNull(p)||u(p),l?(n.setInnerHtml("lblText","Browse and select a new candidate pic."),n.setInnerHtml("photoHeader","Upload Candidate Pic")):c?(n.setInnerHtml("lblText","Browse and select a new company logo."),n.setInnerHtml("photoHeader","Upload Company Logo")):(a.WebCam=!0,n.setInnerHtml("photoHeader","Upload Profile Pic"),n.setInnerHtml("lblText","Browse and select a new profile pic <br>or use your webcam to capture.")),n.TriggerDialog("photo_show",!1)});var g=null,h=null;function u(e){a.CroppedImg=e+"?v="+n.GetRandomNumber(11111,99999)}a.PhotoImage="",a.CroppedImg="",a.FromCam=!1,a.FromImage=!1,a.AddPhoto=!1,a.filePhoto="",a.fileNameChanged=function(e){a.PhotoImage="",a.FromCam=!1,a.FromImage=!1;var o=e.files[0],t=new FileReader;t.onload=function(o){a.$apply(function(e){e.PhotoImage=o.target.result,e.FromImage=!0,e.AddPhoto=!0,n.Show("btnUploadPhoto")})},t.readAsDataURL(o)},a.ResetValues=function(){t.safeApply(function(){a.PhotoImage="",a.CroppedImg="",a.FromCam=!1,a.FromImage=!1,a.filePhoto="",f(),h=null,u(),n.Hide("uploadStatus"),n.Hide("btnUploadPhoto")})},a.GetFromWebCam=function(){a.PhotoImage="",a.CroppedImg="",a.FromCam=!0,a.FromImage=!1,a.AddPhoto=!0,v()},a.CaptureCamera=function(){var e=g.videoWidth,o=g.videoHeight,t=document.createElement("canvas");t.width=e,t.height=o,t.getContext("2d").drawImage(g,0,0,e,o),a.ResetValues(),a.PhotoImage=t.toDataURL("image/png"),a.FromImage=!0,n.Show("btnUploadPhoto")};var v=function(){if(navigator.getWebcam=navigator.getUserMedia||navigator.webKitGetUserMedia||navigator.moxGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.mediaDevices.getUserMedia||navigator.getUserMedia){var o={video:!0,audio:!1};navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(o).then(function(e){h=e,(g=document.getElementById("videoElement")).srcObject=e,g.play()}).catch(function(e){console.log("The following error occured: ",e)}):navigator.getWebcam(o,function(e){h=e,(g=document.getElementById("videoElement")).srcObject=e,g.play()},function(){console.log("The following error occured: ",e)})}else console.log("Webcam is not supported")};var f=function(){if(h){var e="function"==typeof h.getVideoTracks;if(h.getVideoTracks&&e){var o=h.getVideoTracks();o&&o[0]&&o[0].stop&&o[0].stop()}else h.stop&&h.stop()}g&&delete g.src};a.PhotoSubmit=function(){n.Show("uploadStatus");var e=new FormData;e.append("TypeOfDoc","Photos"),e.append("Company",c),e.append("Contact",m),e.append("Candidate",l),e.append("UserId",s),e.append("PhotoCrop",a.CroppedImg),o.UploadContents(e,w,C)};var w=function(e){a.ResetValues();var o=e.data.Results;l?t.$broadcast("CanPhotoUpdated",{KeyId:s,Photo:o}):c?t.$broadcast("CorporatePhotoUpdated",{Photo:o}):m&&(r.Set("Photo",o),n.broadCastPhoto(t)),n.TriggerDialog("pop_closeBtn",!1)},C=function(e){alert("Error some thing goes wrong")}}])});