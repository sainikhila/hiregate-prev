define(["faceitConsApp"+window.__env.minUrl,"angular-sanitize",,window.__env.baseUrl+"services/sharedMethod"+window.__env.minUrl,window.__env.baseUrl+"services/sharedService"+window.__env.minUrl,window.__env.baseUrl+"factory/ngVideoTok"+window.__env.minUrl],function(e){"use strict";e.controller("RecordingController",["$scope","$rootScope","sharedService","sharedMethod","storageFactory","$timeout","user","ngVideoTok",function(t,o,i,r,e,n,a,s){var c=window.__env.mediaUrl,l={},d="",p=0,u=1,f=2,g=4,y=5,v=6,m=8,w=9;t.CurrentState=p,t.ErrorOccurs=!1,t.ErrorMessage="";r.Hide("RecordingMandatory"),0===a.GetInt("UserType",-1)?r.Hide("RecordingMandatory"):r.ShowInline("RecordingMandatory");var h=!1,I=!1;t.IsDeleteRequired=!0,t.videoURL="",t.buttonState=0,t.$on("TriggerForLoadingRecording",function(e,n){d="",null!=n.Record&&!n.Record&&r.IsNull(n.VideoUrl)?(r.Hide("recordingcontainerpanel"),r.Show("norecordingvideo")):(r.IsNull(n.Delete)||(t.IsDeleteRequired=n.Delete),n.PlayOnly?(d=n.VideoUrl,A(v)):A(p))}),t.onInitiateRecording=function(){r.Hide("videoError"),b();var e="U"+a.Get("UserId"),n=a.Get("FullName");l={url:c,LoginId:e,LoginName:n,ConferenceCall:!1,localVideo:r.getElementById("videoInput")},function(){function n(e){t.safeApply(function(){k(e.Reason)})}s.on("connection",function(e){switch(n(e),e.Status){case 1:h?I?s.register(!1):s.register(!0):s.register(!1);break;case 2:case 3:case 5:o.safeApply(function(){C(),r.getElement("videoInput").attr("poster","/content/img/webrtc_small.gif"),A(h?p:v)});break;case 4:d="https://s3-ap-southeast-1.amazonaws.com/fiswas3/Sessions/FI00464.webm",h?I&&(s.setFileName(d),s.playrecord(!1)):(s.setFileName(d),s.playrecord(!1))}}),s.on("recording",function(e){switch(n(e),e.Status){case 1:o.safeApply(function(){A(h?u:m),C()});break;case 2:C();break;case 3:o.safeApply(function(){t.CurrentState=f,C()});break;case 4:C();break;case 5:o.safeApply(function(){d=s.getFileName(),t.CurrentState=g,C()});break;case 6:C()}}),s.on("playing",function(e){switch(n(e),e.Status){case 1:C(),h?I&&A(y):A(m);break;case 3:h?I&&A(g):A(v),C()}}),s.on("onstatus",function(e){n(e)})}(),s.validate(l)?s.connect():C()},t.DoRecord=function(){t.safeApply(function(){I=!(h=!0)}),t.onInitiateRecording()},t.cancelRecord=function(){s.disconnect()},t.startRecord=function(){t.safeApply(function(){I=!(h=!0)}),s.startrecord(!1)},t.stopRecord=function(){s.startrecord(!0)},t.playrecording=function(){t.safeApply(function(){I=!0}),t.onInitiateRecording()},t.stoprecplaying=function(){b(),s.playrecord(!0)},t.saveRecord=function(){o.safeApply(function(){d=s.getFileName()});var e=a.GetInt("UserType",-1);if(window.location.pathname.endsWith("/intsignup")&&(e=-1),parseInt(e)<0)t.$emit("OnVideoChanged",{Url:d}),t.safeApply(function(){t.CurrentState=ButtonStates.StopRecord}),s.setFileName(d),s.disconnect();else{var n={Id:0,Name:d};b(),i.UpdateVideoURL(n,_,S)}};var _=function(e){if(C(),200==e.status){var n=e.data;200==n.status?(d=n.Results.Text,t.$emit("OnVideoModified",{Url:d}),t.safeApply(function(){I=h=!1,t.CurrentState=v}),s.disconnect()):k("System fail to process. Please try again.")}else k("System fail to process. Please try again.")},S=function(e){C(),k("System fail to process. Please try again.")};t.DoPlay=function(){t.safeApply(function(){I=h=!1}),t.onInitiateRecording()},t.stopvdoplaying=function(){s.playrecord(!0)},t.deleteVideo=function(){A(w)},t.noDelete=function(){A(v)},t.yesDelete=function(){var e=a.GetInt("UserType",-1);window.location.pathname.endsWith("/intsignup")&&(e=-1),parseInt(e)<0?(d="",t.$emit("OnVideoChanged",{Url:d}),C(),A(p)):(b(),i.DeleteVideoURL(R,U))};var R=function(e){(C(),200==e.status)?200==e.data.status?(d="",t.$emit("OnVideoModified",{Url:d}),A(p)):k("System fail to process. Please try again."):k("System fail to process. Please try again.")},U=function(e){C(),k("System fail to process. Please try again.")};function b(){r.Hide("videoInput");var e=r.getElement("recordingcontainerpanel");if(e){var n=0,t=e.css("zIndex");isNaN(t)||(n=parseInt(t)+1);var o=r.getPosition(e[0]),i=document.createElement("div");i.id="recordingcontainerpanel_progressbar",$(i).addClass("tc_bg_panel"),$(i).append("<div class='loaderContainer' style='display:block;'> <div class='loaderBlock'>"+'<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 133 152" style="enable-background:new 0 0 133 152" xml:space="preserve"><path class="loaderFI_transparent_outline" d="M106.682,120.633 c2.087,7.738,6.6,15.273,11.069,21.835l-0.607-0.09c-10.761-1.979-20.194-6.567-28.343-11.782h-0.044 \tc-19.054-1.189-32.76-2.213-50.034-3.963l-0.061-0.007c-11.374-1.23-20.468-9.004-22.295-19.231L5.579,60.465 C5.238,58.767,5.066,57,5.066,55.188C4.24,45.005,11.234,35.083,21.643,30.716L80.365,6.881C84.04,5.537,87.664,5,90.694,5 \tc0.807,0,1.435,0.002,2.203,0.084h0.148c12.462,0,22.563,10.211,22.563,22.676v74.26c0,7.083-3.274,13.683-8.376,18.093 L106.682,120.633z" /> <path class="loaderFI_transparent_outline1" fill="transparent" d="M106.682,120.633 c2.087,7.738,6.6,15.273,11.069,21.835l-0.607-0.09c-10.761-1.979-20.194-6.567-28.343-11.782h-0.044 \tc-19.054-1.189-32.76-2.213-50.034-3.963l-0.061-0.007c-11.374-1.23-20.468-9.004-22.295-19.231L5.579,60.465 C5.238,58.767,5.066,57,5.066,55.188C4.24,45.005,11.234,35.083,21.643,30.716L80.365,6.881C84.04,5.537,87.664,5,90.694,5 \tc0.807,0,1.435,0.002,2.203,0.084h0.148c12.462,0,22.563,10.211,22.563,22.676v74.26c0,7.083-3.274,13.683-8.376,18.093 L106.682,120.633z" /> <polygon fill="#279599" points="98.03,40.387 47.716,40.387 47.716,111.115 64.92,111.115 64.92,83.449 91.087,83.449 91.087,70.232 64.92,70.232 64.92,54.378 98.03,54.378 "/></svg></div></div>'),$(i).css("left",o.x),$(i).css("top",o.y),$(i).width(e.width()),$(i).height(e.height()),0<n&&$(i).css("zIndex",n),e.append(i)}}function C(){r.stopcontainer("recordingcontainerpanel");for(var e=r.getElement("recordingcontainerpanel_progressbar");e;)r.removeElement("recordingcontainerpanel_progressbar"),e=r.getElement("recordingcontainerpanel_progressbar");r.Show("videoInput")}function k(e){r.setInnerHtml("videoError",e),r.Show("videoError")}function A(e){t.safeApply(function(){t.CurrentState=e})}}])});